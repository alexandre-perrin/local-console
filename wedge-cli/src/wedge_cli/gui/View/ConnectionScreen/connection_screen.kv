#:import res_path wedge_cli.gui.main.resource_path
#:import get_my_ip wedge_cli.utils.local_network.get_my_ip_by_routing
#:include res_path(components.kv)

<EntryLabel@MDLabel>:
    halign: "right"

<LocalIPTooltip@MDTooltip>:
    MDTooltipPlain:
        text:
            "If the given address resolves to this machine, the QR code \n" \
            "will encode the machine's IP address in the local network."

<FocusText@MDTextField>:
    write_tab: False

<LocalIPInput@LocalIPTooltip+FocusText>:


<ConnectionScreenView>
    md_bg_color: self.theme_cls.backgroundColor
    on_enter: self.model_is_changed()

    MDBoxLayout:
        orientation: "vertical"
        padding: "10dp"
        spacing: "10dp"

        MDBoxLayout:
        # Top bar
            orientation: "horizontal"
            size_hint_y: 1

            MDBoxLayout:
            # Controls half
                orientation: "horizontal"
                size_hint_x: 1
                padding: "10dp"
                spacing: "10dp"

                GoHomeButton:

                MDWidget:

            MDBoxLayout:
            # Status readout half
                orientation: "horizontal"
                size_hint_x: 1
                padding: "5dp"
                spacing: "5dp"

                MDLabel:
                    text: "Connection Status:"
                    size_hint_x: 1
                MDLabel:
                    id: lbl_conn_status
                    size_hint_x: 1

        MDBoxLayout:
        # Top bar
            orientation: "horizontal"
            size_hint_y: 9
            padding: "10dp"
            spacing: "10dp"

            MDBoxLayout:
                orientation: "vertical"
                padding: "10dp"
                spacing: "10dp"
                size_hint_x: 1

                MDGridLayout:
                    cols: 2
                    adaptive_height: True
                    padding: "5dp"
                    spacing: "25dp"

                    EntryLabel:
                        text: "Local IP Address:"
                    MDLabel:
                        text: get_my_ip()
                        allow_selection: True

                    EntryLabel:
                        text: "MQTT host address:"
                    LocalIPInput:
                        id: txt_mqtt_host
                        on_text: root.validate_mqtt_host(*args)
                        multiline: False
                        MDTextFieldHelperText:
                            text: "Enter a valid host address"
                            mode: "on_focus"

                    EntryLabel:
                        text: "MQTT port:"
                    FocusText:
                        id: txt_mqtt_port
                        on_text: root.validate_mqtt_port(*args)
                        multiline: False
                        focus_previous: txt_mqtt_host
                        MDTextFieldHelperText:
                            text: "Enter a valid port number"
                            mode: "on_focus"

                    EntryLabel:
                        text: "NTP server address:"
                    LocalIPInput:
                        id: txt_ntp_host
                        on_text: root.validate_ntp_port(*args)
                        multiline: False
                        focus_previous: txt_mqtt_port
                        focus_next: txt_mqtt_host
                        MDTextFieldHelperText:
                            text: "Enter a valid host address"
                            mode: "on_focus"

                # Spacer
                MDWidget:

            MDBoxLayout:
            # QR code section
                orientation: "vertical"
                size_hint_x: 1
                padding: "5dp"
                spacing: "10dp"

                MDExtendedFabButton:
                    id: btn_qr_gen
                    #size_hint_x: .7
                    fab_state: "expand"
                    valign: "center"
                    on_release: root.controller.qr_generate()
                    MDExtendedFabButtonText:
                        text: "Generate"
                    MDExtendedFabButtonIcon:
                        icon: "qrcode-plus"

                Image:
                    id: img_qr_display
                    color: root.theme_cls.backgroundColor
                    fit_mode: "contain"
